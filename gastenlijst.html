<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gastenlijst - Joy & Janick</title>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Lato', sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; background: #FAF9F6; }
        h1 { color: #A67B5B; }
        table { width: 100%; border-collapse: collapse; background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        th, td { padding: 12px; border-bottom: 1px solid #ddd; text-align: left; }
        th { background-color: #A67B5B; color: white; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        .totaal-box { background: white; padding: 15px; margin-bottom: 20px; border-radius: 8px; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Gastenlijst Overzicht</h1>
    
    <div id="login-box">
        <p>Voer de geheime code in:</p>
        <input type="password" id="secretCode" placeholder="Code...">
        <button onclick="laadGasten()">Bekijk lijst</button>
    </div>

    <div id="data-content" style="display:none;">
        <div class="totaal-box" id="teller">Laden...</div>
        <table id="gastenTable">
            <thead>
                <tr>
                    <th>Type</th> 
                    <th>Naam</th>
                    <th>Aanwezig</th>
                    <th>Aantal</th>
                    <th>Dieet / Opmerking</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>

    <script>
        function laadGasten() {
            const code = document.getElementById('secretCode').value;
            
            // Haal data op van de functie met de geheime code
            fetch(`/.netlify/functions/rsvp?secret=${code}`)
                .then(res => {
                    if (res.status === 401) throw new Error("Foute code!");
                    return res.json();
                })
                .then(data => {
                    document.getElementById('login-box').style.display = 'none';
                    document.getElementById('data-content').style.display = 'block';
                    
                    const tbody = document.getElementById('tableBody');
                    let totaalGasten = 0;
                    let totaalAanmeldingen = 0;

                    data.forEach(rij => {
                        const tr = document.createElement('tr');
                        
                        // Tel alleen als ze 'Ja' hebben gezegd
                        let aantal = rij.aantal_personen ? parseInt(rij.aantal_personen) : 0;
                        if(rij.aanwezig.toLowerCase().includes('ja')) {
                            totaalGasten += aantal;
                            totaalAanmeldingen++;
                        }

                        tr.innerHTML = `
                            <td><small>${rij.gasttype || ''}</small></td> <td><strong>${rij.naam}</strong></td>
                            <td>${rij.aanwezig}</td>
                            <td>${rij.aantal_personen || '-'}</td>
                            <td>
                                ${rij.dieetwensen ? 'üçΩÔ∏è ' + rij.dieetwensen + '<br>' : ''}
                                ${rij.opmerking ? 'üí¨ ' + rij.opmerking : ''}
                            </td>
                        `;
                        tbody.appendChild(tr);
                    });

                    document.getElementById('teller').innerText = 
                        `Totaal 'Ja': ${totaalAanmeldingen} inschrijvingen (${totaalGasten} personen)`;
                })
                .catch(err => alert(err.message));
        }
    </script>
</body>
</html>
